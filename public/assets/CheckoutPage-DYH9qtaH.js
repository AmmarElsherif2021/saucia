import{am as ee,N as _,an as re,O as se,K as oe,r as D,a5 as z,C as e,L as g,V as C,Y as M,W as j,Q as m,T as t,ap as T,aq as E,$ as ne,a0 as ae,a1 as te,a2 as ie,a4 as ce,ar as de,as as le}from"./index-D-3i0_ZZ.js";import{a as he}from"./ComponentsTrial-Du2i7Jey.js";import{s as ue}from"./salad-CfBz2q_T.js";import{p as me,o as pe}from"./order-ZXAFU2kB.js";import{C as W,M as xe}from"./MapModal-DHo5GpTN.js";import{u as ye}from"./use-toast-TcS82ZOd.js";import{u as $}from"./use-breakpoint-value-DhuFUQbX.js";import{H as Y}from"./heading-BF8XlgKi.js";import{S as ge}from"./simple-grid-VxbnG-mh.js";import{F as h}from"./use-form-control-CBGUu0xk.js";import{F as y,S as fe}from"./select-CWzTcnSc.js";import{I as u}from"./input-CoPoFIUG.js";import{D as S}from"./divider-rD5QcCBx.js";import{M as je}from"./modal-footer-hvXhS1BK.js";import"./use-controllable-state-CruS74Kk.js";import"./collapse-DifwqhQZ.js";import"./use-checkbox-OAPZjiff.js";import"./proj-DYl2zGpg.js";import"./grid-Cpr5m2qk.js";const R={isSubmitting:!1,paymentMethod:"",orderInfo:{fullName:"",email:"",phoneNumber:"",deliveryAddress:"",deliveryInstructions:"",saveAddress:!1,saveCard:!1},paymentInfo:{cardNumber:"",expiryDate:"",cvv:"",nameOnCard:""},orderSummary:{subtotal:45.99,deliveryFee:5,promoDiscount:10,total:40.99}};function ve(i,d){switch(d.type){case"SET_PAYMENT_METHOD":return{...i,paymentMethod:d.payload};case"SET_ORDER_INFO":return{...i,orderInfo:{...i.orderInfo,...d.payload}};case"SET_PAYMENT_INFO":return{...i,paymentInfo:{...i.paymentInfo,...d.payload}};case"SET_ORDER_SUMMARY":return{...i,orderSummary:{...i.orderSummary,...d.payload}};case"START_SUBMISSION":return{...i,isSubmitting:!0};case"END_SUBMISSION":return{...i,isSubmitting:!1};default:return i}}const O=({title:i,children:d,bgColor:r,titleColor:n,icon:l})=>{const{colorMode:a}=_(),s=$({base:4,md:6});return e.jsx(g,{bg:a==="dark"?"gray.700":`${r}.200`,borderRadius:"45px",borderWidth:"3px",borderColor:"brand.700",p:s,position:"relative",overflow:"hidden",height:"100%",minHeight:"500px",children:e.jsxs(g,{position:"relative",zIndex:"1",children:[e.jsxs(m,{align:"center",mb:4,children:[l&&e.jsx(g,{as:"img",src:l,alt:`${i} icon`,boxSize:"48px",p:1,mx:4,bg:"whiteAlpha.900",borderRadius:"50%"}),e.jsx(Y,{size:"md",color:n||"gray.800",children:i})]}),d]})})},be=({paymentMethod:i,paymentInfo:d,onPaymentInfoChange:r,t:n,colorMode:l})=>{switch(i){case"credit-card":return e.jsxs(M,{spacing:3,maxW:"90%",children:[e.jsxs(h,{children:[e.jsx(y,{fontSize:"sm",children:n("checkout.cardNumber")}),e.jsx(u,{placeholder:n("checkout.cardNumberPlaceholder")||"1234 5678 9012 3456",variant:"ghost",maxLength:19,value:d.cardNumber,onChange:a=>r("cardNumber",a.target.value),bg:l==="dark"?"gray.800":"warning.100"})]}),e.jsxs(m,{gap:4,direction:{base:"column",sm:"row"},children:[e.jsxs(h,{children:[e.jsx(y,{fontSize:"sm",children:n("checkout.expiryDate")}),e.jsx(u,{placeholder:n("checkout.expiryDatePlaceholder")||"MM/YY",variant:"ghost",maxLength:5,value:d.expiryDate,onChange:a=>r("expiryDate",a.target.value),bg:l==="dark"?"gray.800":"warning.100"})]}),e.jsxs(h,{children:[e.jsx(y,{fontSize:"sm",children:"CVV"}),e.jsx(u,{placeholder:"123",variant:"ghost",maxLength:3,type:"password",value:d.cvv,onChange:a=>r("cvv",a.target.value),bg:l==="dark"?"gray.800":"warning.100"})]})]}),e.jsxs(h,{children:[e.jsx(y,{fontSize:"sm",children:n("checkout.nameOnCard")}),e.jsx(u,{placeholder:n("checkout.cardholderNamePlaceholder")||"John Doe",variant:"ghost",value:d.nameOnCard,onChange:a=>r("nameOnCard",a.target.value),bg:l==="dark"?"gray.800":"warning.100"})]}),e.jsx(W,{colorScheme:"brand",mt:2,children:n("checkout.saveThisCardForFuturePayments")})]});case"paypal":return e.jsxs(C,{spacing:4,align:"stretch",maxW:"90%",children:[e.jsxs(T,{status:"info",borderRadius:"md",children:[e.jsx(E,{}),n("checkout.paypalRedirectMessage")||"You will be redirected to PayPal to complete your payment"]}),e.jsx(j,{colorScheme:"brand",leftIcon:e.jsx(t,{children:"PayPal"}),width:"full",children:n("checkout.continueWithPayPal")||"Continue with PayPal"})]});case"cash-on-delivery":return e.jsxs(C,{spacing:4,align:"stretch",maxW:"90%",children:[e.jsxs(T,{status:"info",borderRadius:"md",children:[e.jsx(E,{}),n("checkout.cashOnDeliveryMessage")||"You will pay in cash when your order is delivered"]}),e.jsx(t,{fontSize:"sm",color:"gray.600",children:n("checkout.cashOnDeliveryNote")||"Please have exact change ready for delivery"})]});default:return null}},ke=({isOpen:i,onClose:d,onConfirm:r,orderData:n,isSubmitting:l,t:a})=>e.jsxs(ne,{isOpen:i,onClose:d,size:"lg",children:[e.jsx(ae,{}),e.jsxs(te,{children:[e.jsx(ie,{children:a("checkout.confirmOrder")||"Confirm Your Order"}),e.jsx(ce,{children:e.jsxs(C,{spacing:4,align:"stretch",children:[e.jsxs(g,{children:[e.jsx(t,{fontWeight:"bold",mb:2,children:a("checkout.deliveryInformation")}),e.jsxs(t,{fontSize:"sm",children:[e.jsxs("strong",{children:[a("checkout.fullName"),":"]})," ",n.orderInfo.fullName]}),e.jsxs(t,{fontSize:"sm",children:[e.jsxs("strong",{children:[a("checkout.phoneNumber"),":"]})," ",n.orderInfo.phoneNumber]}),e.jsxs(t,{fontSize:"sm",children:[e.jsxs("strong",{children:[a("checkout.deliveryAddress"),":"]})," ",n.orderInfo.deliveryAddress]}),e.jsxs(t,{fontSize:"sm",children:[e.jsxs("strong",{children:[a("checkout.city"),":"]})," ",n.orderInfo.city]})]}),e.jsx(S,{}),e.jsxs(g,{children:[e.jsx(t,{fontWeight:"bold",mb:2,children:a("checkout.paymentMethod")}),e.jsx(t,{fontSize:"sm",textTransform:"capitalize",children:n.paymentMethod.replace("-"," ")})]}),e.jsx(S,{}),e.jsxs(g,{children:[e.jsx(t,{fontWeight:"bold",mb:2,children:a("checkout.orderSummary")}),e.jsxs(m,{justify:"space-between",children:[e.jsxs(t,{fontSize:"sm",children:[a("checkout.subtotal"),":"]}),e.jsxs(t,{fontSize:"sm",children:["$",n.orderSummary.subtotal.toFixed(2)]})]}),e.jsxs(m,{justify:"space-between",children:[e.jsxs(t,{fontSize:"sm",children:[a("checkout.deliveryFee"),":"]}),e.jsxs(t,{fontSize:"sm",children:["$",n.orderSummary.deliveryFee.toFixed(2)]})]}),e.jsxs(m,{justify:"space-between",children:[e.jsxs(t,{fontSize:"sm",children:[a("checkout.promoDiscount"),":"]}),e.jsxs(t,{fontSize:"sm",color:"green.500",children:["-$",n.orderSummary.promoDiscount.toFixed(2)]})]}),e.jsx(S,{my:2}),e.jsxs(m,{justify:"space-between",fontWeight:"bold",children:[e.jsxs(t,{children:[a("checkout.total"),":"]}),e.jsxs(t,{children:["$",n.orderSummary.total.toFixed(2)]})]})]})]})}),e.jsxs(je,{children:[e.jsx(j,{variant:"ghost",mr:3,onClick:d,children:a("common.cancel")||"Cancel"}),e.jsx(j,{colorScheme:"brand",onClick:r,isLoading:l,loadingText:a("checkout.processing")||"Processing...",children:a("checkout.confirmOrder")||"Confirm Order"})]})]})]}),qe=()=>{const i=ee(),{colorMode:d}=_(),{user:r,userAddress:n,setUser:l}=re(),a=ye(),{t:s}=se(),{currentLanguage:Se}=oe();D.useEffect(()=>{console.log("Current user from context to checkout page:",r)},[r]);const[I,v]=D.useReducer(ve,{...R,orderInfo:{...R.orderInfo,userId:(r==null?void 0:r.id)||"",user:{id:(r==null?void 0:r.id)||"",email:(r==null?void 0:r.email)||"",displayName:(r==null?void 0:r.displayName)||"",phoneNumber:(r==null?void 0:r.phoneNumber)||""},email:(r==null?void 0:r.email)||"",phoneNumber:(r==null?void 0:r.phoneNumber)||"",deliveryAddress:(n==null?void 0:n.display_name)||(r==null?void 0:r.defaultAddress)||""}}),{isSubmitting:w,paymentMethod:f,orderInfo:c,paymentInfo:U,orderSummary:p}=I,{isOpen:q,onOpen:B,onClose:P}=z(),{isOpen:L,onOpen:H,onClose:F}=z(),x=(o,b)=>{v({type:"SET_ORDER_INFO",payload:{[o]:b}})},V=(o,b)=>{v({type:"SET_PAYMENT_INFO",payload:{[o]:b}})},G=()=>{if(!f){a({title:s("checkout.paymentMethodRequired")||"Payment Method Required",description:s("checkout.pleaseSelectPaymentMethod")||"Please select a payment method",status:"warning",duration:3e3,isClosable:!1});return}if(!c.fullName||!c.phoneNumber||!c.deliveryAddress){a({title:s("checkout.requiredFieldsMissing")||"Required Fields Missing",description:s("checkout.pleaseFillAllRequiredFields")||"Please fill all required fields",status:"warning",duration:3e3,isClosable:!1});return}B()},J=async()=>{v({type:"START_SUBMISSION"}),P();try{if(!(r!=null&&r.uid))throw new Error("User not authenticated");const o=c.deliveryAddress||(r==null?void 0:r.defaultAddress),b={userId:r.uid,user:{id:r.uid,displayName:r.displayName,email:r.email,phoneNumber:c.phoneNumber},items:[],meals:[],totalPrice:p.total,subtotal:p.subtotal,tax:0,discount:p.promoDiscount,deliveryFee:p.deliveryFee,status:"pending",isPaid:f!=="cash-on-delivery",paymentMethod:f,paymentId:f==="cash-on-delivery"?"":`payment_${Date.now()}`,paymentDate:f==="cash-on-delivery"?null:new Date().toISOString(),deliveryAddress:o,deliveryInstructions:c.deliveryInstructions||"",deliveryDate:null,contactPhone:c.phoneNumber,notes:c.notes||"",couponCode:c.couponCode||""},Q=await de(r.uid,b);if(c.saveAddress&&o){const A={firstName:c.fullName.split(" ")[0]||"",lastName:c.fullName.split(" ").slice(1).join(" ")||"",phoneNumber:c.phoneNumber},k=[...(r==null?void 0:r.addresses)||[]],X=k.some(N=>N.address===o);o&&!X&&k.push({id:`addr_${Date.now()}`,address:o,isDefault:!0,createdAt:new Date().toISOString()});const Z={...A,addresses:k,defaultAddress:o};await le(r.uid,Z),l(N=>({...N,...A,addresses:k,defaultAddress:o}))}a({title:s("checkout.orderPlacedSuccessfully")||"Order Placed Successfully",description:s("checkout.orderConfirmationSent")||"Order confirmation has been sent to your email",status:"success",duration:5e3,isClosable:!1}),i(`/order-confirmation/${Q.id}`)}catch(o){console.error("Error placing order:",o),v({type:"END_SUBMISSION"}),a({title:s("checkout.orderFailed")||"Order Failed",description:o.message||s("checkout.failedToPlaceOrder")||"Failed to place order",status:"error",duration:5e3,isClosable:!1})}},K=$({base:1,md:3});return e.jsxs(g,{p:{base:4,md:6},bg:d==="dark"?"gray.800":"gray.50",minHeight:"100vh",children:[e.jsxs(C,{spacing:8,align:"stretch",children:[e.jsx(Y,{as:"h1",size:"xl",textAlign:"center",color:"brand.500",children:s("checkout.deliveryInformation")}),e.jsxs(ge,{columns:K,spacing:6,children:[e.jsx(O,{title:s("checkout.deliveryInformation"),bgColor:"brand",titleColor:"gray.800",icon:ue,children:e.jsxs(M,{spacing:3,children:[e.jsxs(h,{isRequired:!0,children:[e.jsx(y,{fontSize:"sm",children:s("checkout.fullName")}),e.jsx(u,{placeholder:s("checkout.enterYourFullName")||"Enter your full name",variant:"ghost",maxW:"85%",value:c.displayName,onChange:o=>x("fullName",o.target.value)})]}),e.jsxs(h,{isRequired:!0,children:[e.jsx(y,{fontSize:"sm",children:s("checkout.phoneNumber")}),e.jsx(u,{placeholder:s("checkout.yourPhoneNumber")||"Your phone number",variant:"ghost",maxW:"85%",value:c.phoneNumber,onChange:o=>x("phoneNumber",o.target.value)})]}),e.jsxs(h,{isRequired:!0,children:[e.jsx(y,{fontSize:"sm",children:s("checkout.deliveryAddress")}),e.jsx(u,{placeholder:s("checkout.enterDeliveryAddress")||"Enter delivery address",variant:"ghost",maxW:"85%",value:(n==null?void 0:n.display_name)||c.deliveryAddress,onChange:o=>x("deliveryAddress",o.target.value)}),e.jsx(j,{mt:2,size:"sm",variant:"outline",colorScheme:"brand",onClick:H,children:s("checkout.selectOnMap")||"Select on Map"})]}),e.jsx(h,{children:e.jsx(u,{placeholder:s("checkout.specialInstructions"),value:c.notes,variant:"ghost",maxW:"85%",onChange:o=>x("notes",o.target.value)})}),e.jsx(h,{children:e.jsx(u,{placeholder:s("checkout.couponCode"),value:c.couponCode,variant:"ghost",maxW:"85%",onChange:o=>x("couponCode",o.target.value)})}),e.jsx(h,{children:e.jsx(u,{placeholder:s("checkout.deliveryInstructions")||"Optional delivery instructions",variant:"ghost",maxW:"85%",value:c.deliveryInstructions,onChange:o=>x("deliveryInstructions",o.target.value)})}),e.jsx(W,{colorScheme:"brand",mt:2,isChecked:c.saveAddress,onChange:o=>x("saveAddress",o.target.checked),children:s("checkout.saveAddress")||"Save this address for future orders"})]})}),e.jsxs(O,{title:s("checkout.paymentDetails"),bgColor:"warning",icon:me,children:[e.jsxs(h,{mb:4,children:[e.jsx(y,{fontSize:"sm",children:s("checkout.paymentMethod")}),e.jsxs(fe,{placeholder:s("checkout.selectPaymentMethod")||"Select payment method",focusBorderColor:"warning.500",bg:d==="dark"?"gray.800":"warning.100",onChange:o=>v({type:"SET_PAYMENT_METHOD",payload:o.target.value}),children:[e.jsx("option",{value:"credit-card",children:s("checkout.creditCard")||"Credit Card"}),e.jsx("option",{value:"paypal",children:s("checkout.paypal")||"PayPal"}),e.jsx("option",{value:"cash-on-delivery",children:s("checkout.cashOnDelivery")||"Cash on Delivery"})]})]}),e.jsx(be,{paymentMethod:f,paymentInfo:U,onPaymentInfoChange:V,t:s,colorMode:d})]}),e.jsx(O,{title:s("checkout.orderSummary"),bgColor:"accent",icon:pe,children:e.jsxs(M,{spacing:3,children:[e.jsxs(m,{justify:"space-between",mb:2,children:[e.jsxs(t,{children:[s("checkout.subtotal"),":"]}),e.jsxs(t,{fontWeight:"bold",children:["$",p.subtotal.toFixed(2)]})]}),e.jsxs(m,{justify:"space-between",mb:2,children:[e.jsxs(t,{children:[s("checkout.deliveryFee"),":"]}),e.jsxs(t,{fontWeight:"bold",children:["$",p.deliveryFee.toFixed(2)]})]}),e.jsxs(m,{justify:"space-between",mb:2,children:[e.jsxs(t,{children:[s("checkout.promoDiscount"),":"]}),e.jsxs(t,{fontWeight:"bold",color:"green.500",children:["-$",p.promoDiscount.toFixed(2)]})]}),e.jsx(S,{}),e.jsxs(m,{justify:"space-between",mb:4,children:[e.jsxs(t,{fontWeight:"bold",children:[s("checkout.total"),":"]}),e.jsxs(t,{fontWeight:"bold",fontSize:"lg",color:"gray.800",children:["$",p.total.toFixed(2)]})]}),e.jsx(he,{message:{title:s("checkout.orderMinimum")||"Order Minimum",description:s("checkout.orderMinimumDescription")||"Minimum order amount is $25"},type:"info",dismissible:!0}),e.jsx(j,{colorScheme:"brand",size:"lg",width:"full",onClick:G,isLoading:w,loadingText:s("checkout.processing")||"Processing...",children:s("checkout.placeOrder")||"Place Order"}),e.jsx(j,{mt:2,variant:"ghost",width:"full",onClick:()=>i("/menu"),children:s("checkout.backToMenu")||"Back to Menu"})]})})]})]}),e.jsx(xe,{isOpen:L,onClose:F,onSelectLocation:o=>{x("deliveryAddress",o.display_name||o.address),F()}}),e.jsx(ke,{isOpen:q,onClose:P,onConfirm:J,orderData:I,isSubmitting:w,t:s})]})};export{qe as default};
