import{aw as Xe,r as f,a5 as xe,ax as Je,ah as Se,ad as le,ae as Ke,ay as ge,z as Qe,A as en,B as nn,az as on,C as e,D as ae,aA as tn,aB as sn,aC as rn,aD as an,P as cn,al as Oe,L as w,W as X,X as we,ao as ln,T as d,Q as y,K as Ae,an as De,$ as _e,a0 as Le,a1 as Re,a2 as We,a4 as Be,V as je,ap as he,aq as ue,J as Fe,a3 as dn,am as hn,N as Ue,_ as un,O as pn,Y as Pe,as as mn}from"./index-D-3i0_ZZ.js";import{M as xn,C as He}from"./MapModal-DHo5GpTN.js";import{u as Ie}from"./unknownMeal-CabVnnUV.js";import{B as ce}from"./badge-BEYrR1ZS.js";import{S as gn}from"./Star-j31D29az.js";import{u as $e}from"./use-toast-TcS82ZOd.js";import{H as re}from"./heading-BF8XlgKi.js";import{D as fe}from"./divider-rD5QcCBx.js";import{S as de}from"./simple-grid-VxbnG-mh.js";import{M as Ve}from"./modal-footer-hvXhS1BK.js";import{T as fn}from"./tag-CZxeUejg.js";import{p as bn,o as jn}from"./order-ZXAFU2kB.js";import{s as Te}from"./salad-CfBz2q_T.js";import{l as yn}from"./locationPin-BiLmmKIa.js";import{u as Ge}from"./use-breakpoint-value-DhuFUQbX.js";import{F as q}from"./use-form-control-CBGUu0xk.js";import{F as Z,S as ve}from"./select-CWzTcnSc.js";import{I as ne}from"./input-CoPoFIUG.js";import"./use-checkbox-OAPZjiff.js";import"./proj-DYl2zGpg.js";import"./grid-Cpr5m2qk.js";function Sn(n){const t=n.ownerDocument.defaultView||window,{overflow:o,overflowX:i,overflowY:x}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(o+x+i)}function vn(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function Ye(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:Xe(n)&&Sn(n)?n:Ye(vn(n))}function kn(n,t,o){var i,x;return((x=(i=n.__cssMap)==null?void 0:i[`${t}.${o}`])==null?void 0:x.varRef)??o}function Cn(n){var o;const t=f.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(o=n==null?void 0:n.props)==null?void 0:o.ref}const wn={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},Me=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},be=n=>{var t,o;return((o=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:o.defaultView)||window};function Pn(n={}){const{openDelay:t=0,closeDelay:o=0,closeOnClick:i=!0,closeOnMouseDown:x,closeOnScroll:S,closeOnPointerDown:g=x,closeOnEsc:T=!0,onOpen:v,onClose:s,placement:K,id:L,isOpen:D,defaultIsOpen:l,arrowSize:U=10,arrowShadowColor:R,arrowPadding:W,modifiers:V,isDisabled:c,gutter:a,offset:p,direction:b,...u}=n,{isOpen:m,onOpen:E,onClose:z}=xe({isOpen:D,defaultIsOpen:l,onOpen:v,onClose:s}),{referenceRef:k,getPopperProps:G,getArrowInnerProps:h,getArrowProps:j}=Je({enabled:m,placement:K,arrowPadding:W,modifiers:V,gutter:a,offset:p,direction:b}),H=f.useId(),$=`tooltip-${L??H}`,C=f.useRef(null),B=f.useRef(void 0),N=f.useCallback(()=>{B.current&&(clearTimeout(B.current),B.current=void 0)},[]),I=f.useRef(void 0),P=f.useCallback(()=>{I.current&&(clearTimeout(I.current),I.current=void 0)},[]),O=f.useCallback(()=>{P(),z()},[z,P]),oe=Mn(C,O),J=f.useCallback(()=>{if(!c&&!B.current){m&&oe();const r=be(C);B.current=r.setTimeout(E,t)}},[oe,c,m,E,t]),A=f.useCallback(()=>{N();const r=be(C);I.current=r.setTimeout(O,o)},[o,O,N]),te=f.useCallback(()=>{m&&i&&A()},[i,A,m]),se=f.useCallback(()=>{m&&g&&A()},[g,A,m]),ie=f.useCallback(r=>{m&&r.key==="Escape"&&A()},[m,A]);Se(()=>Me(C),"keydown",T?ie:void 0),Se(()=>{if(!S)return null;const r=C.current;if(!r)return null;const M=Ye(r);return M.localName==="body"?be(C):M},"scroll",()=>{m&&S&&O()},{passive:!0,capture:!0}),f.useEffect(()=>{c&&(N(),m&&z())},[c,m,z,N]),f.useEffect(()=>()=>{N(),P()},[N,P]),Se(()=>C.current,"pointerleave",A);const _=f.useCallback((r={},M=null)=>({...r,ref:Ke(C,M,k),onPointerEnter:le(r.onPointerEnter,Y=>{Y.pointerType!=="touch"&&J()}),onClick:le(r.onClick,te),onPointerDown:le(r.onPointerDown,se),onFocus:le(r.onFocus,J),onBlur:le(r.onBlur,A),"aria-describedby":m?$:void 0}),[J,A,se,m,$,te,k]),pe=f.useCallback((r={},M=null)=>G({...r,style:{...r.style,[ge.arrowSize.var]:U?`${U}px`:void 0,[ge.arrowShadowColor.var]:R}},M),[G,U,R]),me=f.useCallback((r={},M=null)=>{const F={...r.style,position:"relative",transformOrigin:ge.transformOrigin.varRef};return{ref:M,...u,...r,id:$,role:"tooltip",style:F}},[u,$]);return{isOpen:m,show:J,hide:A,getTriggerProps:_,getTooltipProps:me,getTooltipPositionerProps:pe,getArrowProps:j,getArrowInnerProps:h}}const ke="chakra-ui:close-tooltip";function Mn(n,t){return f.useEffect(()=>{const o=Me(n);return o.addEventListener(ke,t),()=>o.removeEventListener(ke,t)},[t,n]),()=>{const o=Me(n),i=be(n);o.dispatchEvent(new i.CustomEvent(ke))}}const Dn=ae(cn.div),ye=Qe((n,t)=>{const o=en("Tooltip",n),i=nn(n),x=on(),{children:S,label:g,shouldWrapChildren:T,"aria-label":v,hasArrow:s,bg:K,portalProps:L,background:D,backgroundColor:l,bgColor:U,motionProps:R,animatePresenceProps:W,...V}=i,c=D??l??K??U;if(c){o.bg=c;const k=kn(x,"colors",c);o[ge.arrowBg.var]=k}const a=Pn({...V,direction:x.direction}),p=!f.isValidElement(S)||T;let b;if(p)b=e.jsx(ae.span,{display:"inline-block",tabIndex:0,...a.getTriggerProps(),children:S});else{const k=f.Children.only(S);b=f.cloneElement(k,a.getTriggerProps(k.props,Cn(k)))}const u=!!v,m=a.getTooltipProps({},t),E=u?tn(m,["role","id"]):m,z=sn(m,["role","id"]);return g?e.jsxs(e.Fragment,{children:[b,e.jsx(rn,{...W,children:a.isOpen&&e.jsx(an,{...L,children:e.jsx(ae.div,{...a.getTooltipPositionerProps(),__css:{zIndex:o.zIndex,pointerEvents:"none"},children:e.jsxs(Dn,{variants:wn,initial:"exit",animate:"enter",exit:"exit",...R,...E,__css:o,children:[g,u&&e.jsx(ae.span,{srOnly:!0,...z,children:v}),s&&e.jsx(ae.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:e.jsx(ae.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:o.bg}})})]})})})})]}):e.jsx(e.Fragment,{children:S})});ye.displayName="Tooltip";const zn=Oe({displayName:"SmallCloseIcon",viewBox:"0 0 16 16",path:e.jsx("path",{d:"M9.41 8l2.29-2.29c.19-.18.3-.43.3-.71a1.003 1.003 0 0 0-1.71-.71L8 6.59l-2.29-2.3a1.003 1.003 0 0 0-1.42 1.42L6.59 8 4.3 10.29c-.19.18-.3.43-.3.71a1.003 1.003 0 0 0 1.71.71L8 9.41l2.29 2.29c.18.19.43.3.71.3a1.003 1.003 0 0 0 .71-1.71L9.41 8z",fillRule:"evenodd",fill:"currentColor"})}),qe=Oe({d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z",displayName:"WarningIcon"}),In=({meal:n,index:t,onRemove:o,onChoose:i,isArabic:x,t:S})=>{var g,T;return e.jsxs(w,{as:o?"div":X,variant:"solid",onClick:i?()=>i(n):void 0,position:"relative",w:"100%",h:"180px",borderRadius:"lg",overflow:"hidden",transition:"all 0.2s",bg:"brand.600",_hover:{transform:i?"scale(1.02)":void 0},children:[e.jsx(we,{src:n.image||Ie,alt:x?n.name_arabic:n.name,w:"100%",h:"100%",objectFit:"cover",fallbackSrc:Ie,filter:"brightness(0.9)"}),e.jsx(w,{position:"absolute",bottom:0,left:0,right:0,h:"60%",bgGradient:"linear(to-t, blackAlpha.800, transparent)"}),o&&e.jsx(ln,{"aria-label":"Remove meal",icon:e.jsx(zn,{}),size:"sm",colorScheme:"red",variant:"solid",position:"absolute",top:2,right:2,onClick:v=>{v.stopPropagation(),o(t)},zIndex:"2"}),e.jsxs(w,{position:"absolute",bottom:0,left:0,right:0,p:3,zIndex:"1",children:[e.jsx(d,{fontSize:"lg",fontWeight:"bold",color:"white",noOfLines:2,mb:1,bg:"gray.900",px:0,mx:0,children:x?n.name_arabic:n.name}),e.jsxs(y,{gap:2,mb:2,children:[e.jsxs(ce,{colorScheme:"orange",variant:"solid",fontSize:"xs",children:[n.kcal," kcal"]}),e.jsxs(ce,{colorScheme:"brand",variant:"solid",fontSize:"xs",children:[n.protein,"g protein"]})]}),e.jsx(ye,{label:x&&n.ingredients_arabic||n.ingredients,placement:"top",children:e.jsx(d,{fontSize:"sm",color:"whiteAlpha.800",noOfLines:2,textShadow:"0 1px 2px rgba(0,0,0,0.5)",children:x?(g=(n==null?void 0:n.ingredients_arabic)||(n==null?void 0:n.ingredients))==null?void 0:g.split(",").slice(0,3).join(", "):(T=n==null?void 0:n.ingredients)==null?void 0:T.split(",").slice(0,3).join(", ")})}),n.rate>0&&e.jsxs(y,{position:"absolute",top:-5,left:3,align:"center",bg:"blackAlpha.600",px:2,py:1,borderRadius:"full",children:[e.jsx(gn,{color:"yellow.400",boxSize:3,mr:1}),e.jsx(d,{fontSize:"sm",color:"white",fontWeight:"bold",children:n.rate.toFixed(1)})]}),n.isCustom&&e.jsx(ce,{position:"absolute",top:-8,left:3,colorScheme:"brand",variant:"solid",fontSize:"xs",children:S("checkout.customized")})]})]})},Tn=({isOpen:n,onClose:t,handleSelectMeals:o,handleAddSignatureSalad:i,handleRemoveMeal:x,handleConfirmSubscription:S,userPlan:g,customizedSalad:T,selectedMeals:v,signatureSalads:s,startDate:K,formattedEndDate:L,isSubmitting:D,t:l,MealCard:U,today:R,calculateDeliveryDate:W})=>{var G;const{currentLanguage:V}=Ae(),c=V==="ar",a=$e(),[p,b]=f.useState(null),{user:u}=De();f.useEffect(()=>{console.log(` from confirmation modal of plan ${JSON.stringify(g)}`),L&&b(new Date(L))},[L]);const m=h=>{var H,Q,$;if(!((H=u==null?void 0:u.healthProfile)!=null&&H.allergies)||!(h!=null&&h.allergens))return!1;const j=($=(Q=u==null?void 0:u.healthProfile)==null?void 0:Q.allergies)==null?void 0:$.map(C=>typeof C=="string"&&C.toLowerCase());return h.allergens.some(C=>{var I,P;const B=((I=C.en)==null?void 0:I.toLowerCase())||"",N=((P=C.ar)==null?void 0:P.toLowerCase())||"";return j.some(O=>B.includes(O)||typeof O=="string"&&O.includes(B)||N.includes(O)||typeof O=="string"&&O.includes(N))})},E=({meal:h,index:j,onChoose:H,onRemove:Q,isArabic:$,t:C,showDeliveryDate:B=!1,deliveryDate:N=null})=>{const I=m(h);return e.jsxs(w,{position:"relative",children:[I&&e.jsx(w,{position:"absolute",top:0,left:0,right:0,bottom:0,bg:"rgba(0, 0, 0, 0.1)",borderRadius:"md",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(ye,{label:C("checkout.allergenNotice")||"This meal contains allergens you are sensitive to",placement:"top",children:e.jsxs(y,{bg:"red.500",color:"white",p:2,borderRadius:"full",align:"center",gap:1,children:[e.jsx(Fe,{as:qe,boxSize:4}),e.jsx(d,{fontSize:"xs",fontWeight:"bold",children:C("checkout.allergenNotice")||"Allergen Alert"})]})})}),e.jsx(w,{opacity:I?.6:1,filter:I?"grayscale(50%)":"none",pointerEvents:I?"none":"auto",children:e.jsx(U,{meal:h,index:j,onChoose:I?void 0:H,onRemove:Q,isArabic:$,t:C},j)}),I&&h.allergens&&e.jsxs(w,{mt:2,p:2,bg:"red.50",borderRadius:"md",border:"1px solid",borderColor:"red.200",children:[e.jsxs(d,{fontSize:"xs",color:"red.600",fontWeight:"bold",children:[C("checkout.contains")||"Contains",":"]}),e.jsx(d,{fontSize:"xs",color:"red.500",children:h.allergens.filter(P=>{var A,te,se,ie;const O=((te=(A=u==null?void 0:u.healthProfile)==null?void 0:A.allergies)==null?void 0:te.map(_=>typeof _=="string"&&_.toLowerCase()))||[],oe=((se=P.en)==null?void 0:se.toLowerCase())||"",J=((ie=P.ar)==null?void 0:ie.toLowerCase())||"";return O.some(_=>oe.includes(_)||typeof _=="string"&&_.includes(oe)||J.includes(_)||typeof _=="string"&&_.includes(J))}).map(P=>$?P.ar:P.en).join(", ")})]}),B&&N&&e.jsx(d,{fontSize:"xs",textAlign:"center",mt:1,color:"gray.500",children:N.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})},z=h=>{if(m(h)){a({title:l("checkout.allergenNotice")||"Allergen Warning",description:l("checkout.allergenMealWarning")||"This meal contains allergens you are sensitive to and cannot be selected.",status:"error",duration:5e3,isClosable:!1});return}if(u.subscription.mealsCount&&v.length>=u.subscription.mealsCount){a({title:l("checkout.planLimitReachedTitle"),description:l("",{mealsCount:g.mealsCount}),status:"error",duration:5e3});return}const j=v.length,H=W(R,j);a({title:l("checkout.mealAddedTitle"),description:l("",{mealName:c?h.name_arabic:h.name,deliveryDate:H.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),remainingMeals:g.mealsCount-v.length-1}),status:"success",duration:3e3}),i(h)},k=h=>(h==null?void 0:h.filter(j=>m(j)).length)||0;return e.jsxs(_e,{isOpen:n,onClose:t,size:"xl",children:[e.jsx(Le,{}),e.jsxs(Re,{sx:{minWidth:"50vw",maxWidth:"90vw",margin:"5vw",padding:"1vw"},children:[e.jsx(We,{children:l("checkout.confirmSubscription")}),e.jsx(Be,{sx:{maxHeight:"60vh",minWidth:"50vw",overflowY:"auto",overflowX:"hidden"},children:e.jsxs(je,{spacing:6,align:"stretch",children:[e.jsxs(w,{children:[e.jsx(re,{size:"xl",mb:2,children:l("checkout.planDetails")}),e.jsxs(y,{justify:"space-between",mb:1,children:[e.jsx(d,{children:l("checkout.plan")}),e.jsx(d,{fontWeight:"bold",children:(g==null?void 0:g.title)||l("checkout.premiumPlan")})]}),e.jsxs(y,{justify:"space-between",mb:1,children:[e.jsx(d,{children:l("checkout.startDate")}),e.jsx(d,{fontWeight:"bold",children:K})]}),e.jsxs(y,{justify:"space-between",mb:1,children:[e.jsx(d,{children:l("checkout.endDate")}),e.jsx(d,{fontWeight:"bold",children:L})]}),(g==null?void 0:g.mealsCount)&&e.jsxs(y,{justify:"space-between",children:[e.jsx(d,{children:l("checkout.remainingMeals")}),e.jsxs(d,{fontWeight:"bold",children:[g.mealsCount-v.length," / ",g.mealsCount]})]})]}),e.jsx(fe,{}),(k(s)>0||T&&m(T))&&e.jsxs(he,{status:"warning",borderRadius:"md",children:[e.jsx(ue,{}),e.jsxs(w,{children:[e.jsx(d,{fontWeight:"bold",children:l("checkout.allergenNotice")||"Allergen Notice"}),e.jsx(d,{fontSize:"sm",children:l("checkout.allergenNoticeDescription")||"Some meals are not available due to your allergen preferences. These meals are grayed out and cannot be selected."})]})]}),e.jsxs(w,{children:[e.jsxs(y,{justify:"space-between",align:"center",mb:4,children:[e.jsx(re,{size:"lg",children:l("checkout.yourMealPlan")}),e.jsx(w,{size:"xl",w:"100px",h:"100px",px:4,colorScheme:"brand",as:X,variant:"outline",onClick:o,fontSize:"xs",children:l("checkout.selectedMeal")})]}),T&&s.length>0?e.jsxs(w,{children:[e.jsxs(d,{mb:2,children:[l("checkout.selectedMeals"),":"]}),e.jsx(de,{p:10,columns:{base:1,md:2,lg:3,xl:4},spacing:5,children:[...s,T].map((h,j)=>e.jsx(E,{meal:h,index:j,onChoose:z,isArabic:c,t:l},j))})]}):(s==null?void 0:s.length)>0?e.jsxs(w,{children:[e.jsxs(d,{mb:2,children:[l("checkout.defaultSignatureSalads"),":"]}),e.jsx(de,{p:5,columns:{base:1,md:2,lg:3,xl:3},spacing:1,children:s==null?void 0:s.map((h,j)=>e.jsx(w,{children:e.jsx(E,{index:h.id,onChoose:z,meal:h,isArabic:c,t:l})},j))})]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{children:"Sorry!"}),e.jsx(d,{children:"There are no salads to choose, we are working on it"})]})]}),e.jsx(w,{children:e.jsx(de,{p:10,columns:{base:1,md:2,lg:3,xl:3},spacing:3,children:v.length>0&&v.map((h,j)=>{const H=W(R,j);return e.jsx(y,{direction:"column",children:e.jsx(E,{meal:h,index:j,onRemove:x,isArabic:c,t:l,showDeliveryDate:!0,deliveryDate:H})},j)})})}),e.jsxs(he,{status:"info",borderRadius:"md",children:[e.jsx(ue,{}),l("checkout.subscriptionRenewal")]})]})}),e.jsxs(Ve,{children:[e.jsx(X,{variant:"outline",mx:5,onClick:t,children:l("checkout.back")}),e.jsx(X,{mx:5,colorScheme:"brand",disabled:v.length<((G=u==null?void 0:u.subscription)==null?void 0:G.mealsCount),onClick:S,isLoading:D,children:l("checkout.confirmAndPay")})]})]})]})},En=({isOpen:n,onClose:t,onConfirm:o,saladItems:i,t:x,isArabic:S})=>{const[g,T]=f.useState({}),[v,s]=f.useState({}),[K,L]=f.useState({}),{user:D}=De();f.useEffect(()=>{D&&console.log(`User data in CustomizableMealSelectionModal: ${JSON.stringify(D.healthProfile.allergies)}`)},[D]);const l=c=>{var p;if(!((p=D==null?void 0:D.healthProfile)!=null&&p.allergies)||!(c!=null&&c.allergens))return!1;const a=D.healthProfile.allergies.map(b=>typeof b=="string"&&b.toLowerCase());return c.allergens.some(b=>{var E,z;const u=((E=b.en)==null?void 0:E.toLowerCase())||"",m=((z=b.ar)==null?void 0:z.toLowerCase())||"";return a.some(k=>u.includes(k)||typeof k=="string"&&k.includes(u)||m.includes(k)||typeof k=="string"&&k.includes(m))})};f.useEffect(()=>{if(i&&i.length>0){const c={},a={};i.forEach(p=>{c[p.section]||(c[p.section]=[],a[p.section]={value:1,key_arabic:p.section_arabic||p.section}),c[p.section].push(p)}),s(c),L(a)}},[i]);const U=c=>{l(c)||T(a=>{const p=Object.keys(a).filter(b=>{const u=i.find(m=>m.id===b);return(u==null?void 0:u.section)===c.section});if(p.length>0){const b={...a};return delete b[p[0]],{...b,[c.id]:1}}return{...a,[c.id]:1}})},R=Object.values(g).reduce((c,a)=>c+a,0),W=c=>{var a,p;return e.jsxs(d,{fontWeight:"bold",mb:2,children:[S&&((p=(a=v[c])==null?void 0:a[0])==null?void 0:p.section_arabic)||c,e.jsxs(d,{as:"span",fontSize:"sm",color:"gray.500",ml:2,children:["(",x("menuPage.selectUpTo")," 1)"]})]})},V=c=>{const a=l(c);return e.jsxs(y,{direction:"column",flex:"1",children:[e.jsxs(y,{align:"center",gap:2,children:[e.jsx(d,{fontWeight:"medium",color:a?"gray.400":"inherit",textDecoration:a?"line-through":"none",children:S?c.name_arabic:c.name}),a&&e.jsx(ye,{label:x("checkout.allergenNotice")||"This item contains allergens you are sensitive to",placement:"top",children:e.jsx(Fe,{as:qe,color:"red.500",boxSize:4})})]}),e.jsx(d,{fontSize:"sm",color:a?"gray.400":"gray.600"}),a&&c.allergens&&e.jsxs(d,{fontSize:"xs",color:"red.500",mt:1,children:[x("contains")||"Contains",":"," ",c.allergens.filter(p=>{var E,z,k,G;const b=((z=(E=D==null?void 0:D.healthProfile)==null?void 0:E.allergies)==null?void 0:z.map(h=>typeof h=="string"&&h.toLowerCase()))||[],u=((k=p.en)==null?void 0:k.toLowerCase())||"",m=((G=p.ar)==null?void 0:G.toLowerCase())||"";return b.some(h=>u.includes(h)||typeof h=="string"&&h.includes(u)||m.includes(h)||typeof h=="string"&&h.includes(m))}).map(p=>S?p.ar:p.en).join(", ")]})]})};return e.jsxs(_e,{isOpen:n,onClose:t,children:[e.jsx(Le,{}),e.jsxs(Re,{sx:{padding:"2vw",width:"90%",minWidth:"75vw",maxHeight:"90vh"},children:[e.jsx(We,{sx:{paddingTop:"6vh"},children:e.jsxs(y,{justify:"space-between",align:"center",w:"100%",direction:"column",children:[e.jsx(re,{fontSize:"1.2em",fontWeight:"bold",children:x("checkout.customizeYourSalad")}),e.jsx(d,{fontWeight:"bold",color:"green.600",fontSize:"0.4em",mx:1,children:x("checkout.customizePolicy")})]})}),e.jsx(dn,{}),e.jsxs(Be,{children:[e.jsx(d,{mb:4,fontSize:"sm",color:"gray.600",children:x("checkout.customizeSaladInstructions")}),e.jsx(de,{p:10,m:0,columns:[1,2],spacing:3,bg:"accent.300",borderRadius:"md",sx:{maxHeight:"40vh",overflowY:"scroll"},children:Object.entries(v).map(([c,a])=>e.jsxs(w,{mb:6,children:[W(c),a.map(p=>{const b=l(p),u=(g[p.id]||0)>0;return e.jsxs(y,{p:1,m:1,height:"fit-content",minHeight:12,borderWidth:0,borderRadius:"md",align:"center",justify:"space-between",bg:u?"brand.300":b?"gray.50":"white",color:"brand.800",opacity:b?.6:1,onClick:()=>U(p),cursor:b?"not-allowed":"pointer",_hover:b?{}:{bg:u?"brand.400":"gray.50"},borderColor:b?"red.200":"gray.200",children:[V(p),u&&!b&&e.jsx(y,{align:"center",gap:2,onClick:m=>m.stopPropagation(),children:e.jsx(d,{minW:"30px",textAlign:"center",children:g[p.id]})})]},p.id)})]},c))})]}),e.jsxs(Ve,{children:[e.jsx(fn,{mr:4,colorScheme:"green",children:x("menuPage.selectedCount",{count:R})}),e.jsx(X,{sx:{marginX:2},colorScheme:"brand",onClick:()=>o(g),children:x("checkout.confirmSelection")})]})]})]})},Ee={isSubmitting:!1,paymentMethod:"",period:12,selectedMeals:[],customizedSalad:null,billingInfo:{fullName:"",email:"",phoneNumber:"",deliveryAddress:"",deliveryTime:"12:00"}};function Nn(n,t){switch(t.type){case"SET_PAYMENT_METHOD":return{...n,paymentMethod:t.payload};case"SET_PERIOD":return{...n,period:t.payload};case"SET_SELECTED_MEALS":return{...n,selectedMeals:t.payload};case"SET_CUSTOMIZED_SALAD":return{...n,customizedSalad:t.payload};case"ADD_SIGNATURE_SALAD":return{...n,selectedMeals:[...n.selectedMeals,t.payload]};case"REMOVE_MEAL":return{...n,selectedMeals:n.selectedMeals.filter((o,i)=>i!==t.payload)};case"SET_BILLING_INFO":return{...n,billingInfo:{...n.billingInfo,...t.payload}};case"START_SUBMISSION":return{...n,isSubmitting:!0};case"END_SUBMISSION":return{...n,isSubmitting:!1};case"RESET_MEALS":return{...n,selectedMeals:[],customizedSalad:null};default:return n}}const Ce=({title:n,children:t,bgColor:o,titleColor:i,icon:x})=>{const{colorMode:S}=Ue(),g=Ge({base:4,md:6});return e.jsx(w,{bg:S==="dark"?"gray.700":`${o}.300`,borderRadius:"45px",borderWidth:"3px",borderColor:S==="dark"?"gray.600":`${o}.500`,p:g,position:"relative",overflow:"hidden",height:"100%",maxHeight:"95vh",minHeight:"85vh",my:20,children:e.jsxs(w,{position:"relative",zIndex:"1",children:[e.jsxs(y,{align:"center",mb:5,children:[x&&e.jsx(w,{as:"img",src:x,alt:`${n} icon`,boxSize:"48px",mx:2,borderRadius:"50%",p:1,bg:"whiteAlpha.900"}),e.jsx(re,{size:"md",color:i||"brand.900",children:n})]}),t]})})},On=({paymentMethod:n,t,colorMode:o})=>{switch(n){case"credit-card":return e.jsxs(Pe,{spacing:3,maxW:"90%",children:[e.jsxs(q,{children:[e.jsx(Z,{fontSize:"sm",children:t("checkout.cardNumber")}),e.jsx(ne,{placeholder:t("checkout.cardNumberPlaceholder"),variant:"ghost",maxLength:19})]}),e.jsxs(y,{gap:4,direction:{base:"column",sm:"row"},children:[e.jsxs(q,{children:[e.jsx(Z,{fontSize:"sm",children:t("checkout.expiryDate")}),e.jsx(ne,{placeholder:t("checkout.expiryDatePlaceholder"),variant:"ghost",maxLength:5})]}),e.jsxs(q,{children:[e.jsx(Z,{fontSize:"sm",children:"CVV"}),e.jsx(ne,{placeholder:"123",variant:"ghost",maxLength:3,type:"password"})]})]}),e.jsxs(q,{children:[e.jsx(Z,{fontSize:"sm",children:t("checkout.nameOnCard")}),e.jsx(ne,{placeholder:t("checkout.cardholderNamePlaceholder"),variant:"ghost"})]}),e.jsx(He,{colorScheme:"brand",mt:2,children:t("checkout.saveThisCardForFuturePayments")})]});case"paypal":return e.jsxs(je,{spacing:4,align:"stretch",maxW:"90%",children:[e.jsxs(he,{status:"info",borderRadius:"md",children:[e.jsx(ue,{}),t("checkout.paypalRedirectMessage")]}),e.jsx(X,{colorScheme:"brand",leftIcon:e.jsx(d,{children:"PayPal"}),width:"full",children:t("checkout.continueWithPayPal")})]});case"apple-pay":case"google-pay":return e.jsxs(je,{spacing:4,align:"stretch",maxW:"90%",children:[e.jsxs(he,{status:"info",borderRadius:"md",children:[e.jsx(ue,{}),t("checkout.completePaymentWith",{method:n==="apple-pay"?"Apple Pay":"Google Pay"})]}),e.jsx(X,{colorScheme:n==="apple-pay"?"blackAlpha":"brand",width:"full",children:t("checkout.payWith",{method:n==="apple-pay"?"Apple Pay":"Google Pay"})})]});default:return null}},Ne=(n,t)=>{let o=new Date(n),i=0;for(;i<=t;)o.setDate(o.getDate()+1),o.getDay()!==5&&o.getDay()!==6&&i++;return o},An=(n,t)=>{let o=new Date(n),i=0;for(;i<t;)o.setDate(o.getDate()+1),o.getDay()!==5&&o.getDay()!==6&&i++;return o},to=()=>{var _,pe,me;const n=hn(),{colorMode:t}=Ue(),{user:o,userPlan:i,setUser:x,userAddress:S}=De(),{saladItems:g,signatureSalads:T}=un(),v=$e(),{t:s}=pn(),{currentLanguage:K}=Ae(),L=K==="ar",[D,l]=f.useReducer(Nn,{...Ee,billingInfo:{...Ee.billingInfo,fullName:`${(o==null?void 0:o.firstName)||""} ${(o==null?void 0:o.lastName)||""}`.trim(),email:(o==null?void 0:o.email)||"",phoneNumber:(o==null?void 0:o.phoneNumber)||"",deliveryAddress:S||(o==null?void 0:o.defaultAddress)||"",deliveryTime:((_=o==null?void 0:o.subscription)==null?void 0:_.deliveryTime)||"12:00"}}),{isSubmitting:U,paymentMethod:R,period:W,selectedMeals:V,customizedSalad:c,billingInfo:a}=D,{isOpen:p,onOpen:b,onClose:u}=xe(),{isOpen:m,onOpen:E,onClose:z}=xe(),{isOpen:k,onOpen:G,onClose:h}=xe(),j=new Date,H=j.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),Q=An(j,W),$=Q.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),C=49.99,B=10,N=C-B,I=()=>{const r=[...V];return c&&r.push(c),r.length>0?r:T.slice(0,W)},P=(r,M)=>{l({type:"SET_BILLING_INFO",payload:{[r]:M}})},O=()=>{if(!R){v({title:s("checkout.paymentMethodRequired"),description:s("checkout.pleaseSelectPaymentMethod"),status:"warning",duration:3e3,isClosable:!1});return}if(!a.fullName||!a.email||!a.deliveryAddress){v({title:s("checkout.requiredFieldsMissing"),description:s("checkout.pleaseFillAllRequiredFields"),status:"warning",duration:3e3,isClosable:!1});return}b()},oe=()=>E(),J=r=>{const M=Object.keys(r),F=g.filter(Y=>M.includes(Y.id));l({type:"SET_CUSTOMIZED_SALAD",payload:{id:"custom-salad-"+Date.now(),name:s("checkout.customSalad"),name_arabic:s("checkout.customSalad",{lng:"ar"}),calories:F.reduce((Y,ee)=>Y+(ee.calories||0),0),price:F.reduce((Y,ee)=>Y+(ee.price||0),0),items:F,isCustom:!0}}),z()},A=r=>{l({type:"ADD_SIGNATURE_SALAD",payload:r})},te=r=>{l({type:"REMOVE_MEAL",payload:r})},se=async()=>{var r;l({type:"START_SUBMISSION"}),u();try{if(!(o!=null&&o.uid))throw new Error("User not authenticated");const M=I(),F=a.deliveryAddress||(o==null?void 0:o.defaultAddress),Y={firstName:a.fullName.split(" ")[0]||"",lastName:a.fullName.split(" ").slice(1).join(" ")||"",phoneNumber:a.phoneNumber},ee=[...(o==null?void 0:o.addresses)||[]];F&&!ee.includes(F)&&ee.push(F);const ze={subscription:{planId:(i==null?void 0:i.id)||"premium-plan",planName:(i==null?void 0:i.title)||"Premium Plan",startDate:j.toISOString(),endDate:Q.toISOString(),status:"active",paymentMethod:R,price:N,mealsCount:W,consumedMeals:((r=o==null?void 0:o.subscription)==null?void 0:r.consumedMeals)||0,meals:M,deliveryAddress:F,deliveryTime:a.deliveryTime,autoRenewal:!1,deliveryPaused:!1,nextMealDate:Ne(j,0).toISOString()},...Y,addresses:ee,defaultAddress:F};await mn(o.uid,ze),x(Ze=>({...Ze,...Y,addresses:ee,defaultAddress:F,subscription:ze.subscription})),v({title:s("checkout.subscriptionSuccessful"),description:s("checkout.premiumPlanActive"),status:"success",duration:5e3,isClosable:!1}),n("/account?subscription=success")}catch(M){console.error("Error confirming subscription:",M),l({type:"END_SUBMISSION"}),v({title:s("checkout.subscriptionFailed"),description:M.message||s("checkout.failedToUpdatePlanSubscription"),status:"error",duration:5e3,isClosable:!1})}},ie=Ge({base:1,md:3});return e.jsxs(w,{p:{base:4,md:6},bg:t==="dark"?"gray.800":"gray.50",minHeight:"100vh",children:[e.jsxs(je,{spacing:2,align:"stretch",children:[e.jsx(re,{as:"h1",size:"xl",textAlign:"center",color:"brand.800",children:s("checkout.completeYourSubscription")}),!i&&e.jsxs(he,{status:"warning",borderRadius:"md",children:[e.jsx(ue,{}),s("checkout.noPlanSelected")]}),e.jsxs(de,{columns:ie,spacing:4,children:[e.jsx(Ce,{title:s("checkout.billingInformation"),bgColor:"teal",icon:Te,children:e.jsxs(Pe,{spacing:2,children:[e.jsxs(q,{isRequired:!0,children:[e.jsx(Z,{fontSize:"sm",children:s("checkout.fullName")}),e.jsx(ne,{placeholder:s("checkout.enterYourFullName"),variant:"ghost",bg:t==="dark"?"gray.800":"brand.200",focusBorderColor:"brand.500",maxW:"85%",value:a.fullName,onChange:r=>P("fullName",r.target.value)})]}),e.jsxs(q,{isRequired:!0,children:[e.jsx(Z,{fontSize:"sm",children:s("checkout.emailAddress")}),e.jsx(ne,{type:"email",maxW:"85%",placeholder:s("checkout.yourEmailAddress"),variant:"ghost",bg:t==="dark"?"gray.800":"brand.200",focusBorderColor:"brand.500",value:a.email,onChange:r=>P("email",r.target.value)})]}),e.jsxs(q,{children:[e.jsx(Z,{fontSize:"sm",children:s("checkout.phoneNumber")}),e.jsx(ne,{placeholder:s("checkout.yourPhoneNumber"),variant:"ghost",bg:t==="dark"?"gray.800":"brand.200",focusBorderColor:"brand.500",maxW:"85%",value:a.phoneNumber,onChange:r=>P("phoneNumber",r.target.value)})]}),e.jsxs(q,{isRequired:!0,children:[e.jsx(Z,{fontSize:"sm",children:s("checkout.deliveryAddress")}),e.jsxs(y,{alignItems:"center",maxW:"85%",children:[e.jsx(ne,{placeholder:s("checkout.enterDeliveryAddress"),variant:"outlined",bg:t==="dark"?"gray.800":"brand.200",focusBorderColor:"brand.500",maxW:"85%",value:(S==null?void 0:S.display_name)||((pe=a==null?void 0:a.deliveryAddress)==null?void 0:pe.display_name),onChange:r=>P("deliveryAddress",r.target.value)}),e.jsx(X,{mx:2,onClick:G,children:e.jsx(we,{src:yn,alt:"Location Pin",boxSize:"30px"})})]}),e.jsx(xn,{isOpen:k,onClose:h,onSelectLocation:()=>console.log("trying to set location")})]}),e.jsxs(q,{children:[e.jsx(Z,{fontSize:"sm",children:s("checkout.deliveryTime")}),e.jsxs(ve,{maxW:"85%",bg:t==="dark"?"gray.800":"brand.200",focusBorderColor:"brand.500",value:a.deliveryTime,onChange:r=>P("deliveryTime",r.target.value),children:[e.jsx("option",{value:"09:00",children:"09:00 AM"}),e.jsx("option",{value:"10:00",children:"10:00 AM"}),e.jsx("option",{value:"11:00",children:"11:00 AM"}),e.jsx("option",{value:"12:00",children:"12:00 PM"}),e.jsx("option",{value:"13:00",children:"01:00 PM"}),e.jsx("option",{value:"14:00",children:"02:00 PM"}),e.jsx("option",{value:"15:00",children:"03:00 PM"}),e.jsx("option",{value:"16:00",children:"04:00 PM"}),e.jsx("option",{value:"17:00",children:"05:00 PM"}),e.jsx("option",{value:"18:00",children:"06:00 PM"})]})]}),e.jsx(He,{colorScheme:"brand",mt:2,children:s("checkout.sendMePlanUpdatesAndNotifications")})]})}),e.jsxs(Ce,{title:s("checkout.paymentDetails"),bgColor:"secondary",icon:bn,children:[e.jsxs(q,{mb:4,children:[e.jsx(Z,{fontSize:"sm",children:s("checkout.paymentMethod")}),e.jsxs(ve,{placeholder:s("checkout.selectPaymentMethod"),focusBorderColor:"secondary.500",bg:t==="dark"?"gray.800":"secondary.100",onChange:r=>l({type:"SET_PAYMENT_METHOD",payload:r.target.value}),children:[e.jsx("option",{value:"credit-card",children:"Credit Card"}),e.jsx("option",{value:"paypal",children:"PayPal"}),e.jsx("option",{value:"apple-pay",children:"Apple Pay"}),e.jsx("option",{value:"google-pay",children:"Google Pay"})]})]}),e.jsx(On,{paymentMethod:R,t:s,colorMode:t})]}),e.jsxs(Ce,{title:s("checkout.subscriptionSummary"),bgColor:"warning",icon:jn,children:[i?e.jsxs(w,{children:[e.jsxs(y,{alignItems:"center",mb:2,children:[e.jsx(we,{src:i.image||Te,alt:i.title,boxSize:"60px",borderRadius:"25%",bg:t==="dark"?"gray.700":"warning.100",mx:4,p:2}),e.jsx(w,{children:e.jsx(re,{size:"xs",children:L?i.title_arabic:i.title})})]}),e.jsx(fe,{mb:1}),e.jsxs(Pe,{spacing:2,children:[e.jsxs(y,{justify:"space-between",align:"center",children:[e.jsxs(d,{fontSize:"sm",children:[s("premium.nutritionalInformation"),":"]}),e.jsxs(y,{wrap:"wrap",gap:1,children:[e.jsxs(ce,{fontSize:"0.5em",colorScheme:"green",children:[s("kcal"),": ",i.kcal]}),e.jsxs(ce,{fontSize:"0.5em",colorScheme:"brand",children:[s("carbs"),": ",i.carb,"g"]}),e.jsxs(ce,{fontSize:"0.5em",colorScheme:"red",children:[s("protein"),": ",i.protein,"g"]})]})]}),e.jsxs(y,{justify:"space-between",align:"center",children:[e.jsxs(d,{fontSize:"sm",children:[s("checkout.subscriptionPeriod"),":"]}),e.jsx(ve,{px:3,mx:4,w:"auto",value:W,onChange:r=>l({type:"SET_PERIOD",payload:Number(r.target.value)}),focusBorderColor:"brand.500",bg:"warning.50",children:(me=i.periods)==null?void 0:me.map((r,M)=>e.jsx("option",{value:r,children:e.jsxs("span",{children:[" ",r," ",s("days")," "]})},M))})]}),e.jsxs(y,{justify:"space-between",align:"center",children:[e.jsxs(d,{fontSize:"sm",children:[s("checkout.selectedMeals"),":"]}),e.jsxs(d,{fontSize:"sm",color:"brand.900",children:[" ",I().length]})]})]})]}):e.jsx(d,{children:s("noPlanSelected")}),e.jsx(fe,{mb:2}),e.jsxs(y,{justify:"space-between",mb:2,children:[e.jsx(d,{fontSize:"sm",children:s("checkout.monthlySubscription")}),e.jsxs(d,{fontSize:"sm",children:["$",C.toFixed(2)]})]}),e.jsxs(y,{justify:"space-between",mb:2,children:[e.jsx(d,{fontSize:"sm",children:s("checkout.newSubscriberDiscount")}),e.jsxs(d,{fontSize:"sm",fontWeight:"bold",color:"green.500",children:["-$",B.toFixed(2)]})]}),e.jsx(fe,{my:1}),e.jsxs(y,{justify:"space-between",mb:4,children:[e.jsx(d,{fontSize:"sm",fontWeight:"bold",children:s("checkout.totalToday")}),e.jsxs(d,{fontSize:"sm",fontWeight:"bold",color:"brand.800",children:["$",N.toFixed(2)]})]}),e.jsx(d,{fontSize:"xs",color:"gray.600",mb:4,children:s("checkout.subscriptionTerms")}),e.jsx(X,{colorScheme:"brand",size:"sm",width:"full",onClick:O,isLoading:U,loadingText:s("checkout.processing"),isDisabled:!i,children:s("checkout.completeSubscription")}),e.jsx(X,{mt:2,variant:"ghost",width:"full",onClick:()=>n("/premium"),children:s("checkout.backToPlans")})]})]})]}),e.jsx(En,{isOpen:m,onClose:z,onConfirm:J,saladItems:g,t:s,isArabic:L}),e.jsx(Tn,{isOpen:p,onClose:u,handleSelectMeals:oe,handleAddSignatureSalad:A,handleRemoveMeal:te,handleConfirmSubscription:se,userPlan:i,customizedSalad:c,selectedMeals:V,signatureSalads:T,startDate:H,formattedEndDate:$,isSubmitting:U,t:s,MealCard:In,today:j,calculateDeliveryDate:Ne})]})};export{to as default};
